<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KosKu - Pengelola Keuangan & Tugas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <style>
        /* ========== RESET & VARIABLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4A90E2;
            --secondary: #5CB3FF;
            --danger: #E74C3C;
            --warning: #F39C12;
            --success: #27AE60;
            --light: #F8F9FA;
            --dark: #2C3E50;
            --gray: #95A5A6;
            --bg-body: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-container: white;
            --text-primary: #2C3E50;
            --text-secondary: #555;
            --border-color: #E0E0E0;
            --card-bg: white;
            --input-bg: white;
            --chart-grid: rgba(0, 0, 0, 0.1);
            --chart-text: #666;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary: #5BA3FF;
            --secondary: #7CC5FF;
            --bg-body: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --bg-container: #0f1419;
            --text-primary: #E8E8E8;
            --text-secondary: #B8B8B8;
            --border-color: #2a2a2a;
            --light: #1a1a1a;
            --card-bg: #16181d;
            --input-bg: #1a1a1a;
            --dark: #E8E8E8;
            --chart-grid: rgba(255, 255, 255, 0.1);
            --chart-text: #B8B8B8;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-body);
            min-height: 100vh;
            padding: 10px;
            transition: all 0.3s ease;
        }

        /* ========== CONTAINER ========== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-container);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* ========== HEADER ========== */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .theme-toggle i {
            font-size: 1.3em;
            color: white;
        }

        /* ========== NAVIGATION TABS ========== */
        .tabs {
            display: flex;
            overflow-x: auto;
            background: var(--light);
            border-bottom: 3px solid var(--primary);
            transition: all 0.3s ease;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 0.85em;
            font-weight: 500;
            color: var(--text-primary);
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab i {
            display: block;
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        /* ========== CONTENT SECTIONS ========== */
        .content {
            padding: 20px;
            background: var(--bg-container);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: var(--text-primary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== FORMS ========== */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Checkbox for unknown deadline */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            font-size: 0.85em;
            padding: 8px 16px;
        }

        .btn-danger:hover {
            background: #C0392B;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            font-size: 0.85em;
            padding: 8px 16px;
        }

        .btn-warning:hover {
            background: #E67E22;
        }

        .btn-success {
            background: var(--success);
            color: white;
            font-size: 0.85em;
            padding: 8px 16px;
        }

        .btn-success:hover {
            background: #229954;
        }

        /* ========== CARDS ========== */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .card h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.2em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.expense {
            background: linear-gradient(135deg, var(--danger), #C0392B);
        }

        .stat-card.income {
            background: linear-gradient(135deg, var(--success), #229954);
        }

        .stat-card.balance {
            background: linear-gradient(135deg, var(--warning), #E67E22);
        }

        .stat-card h4 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .amount {
            font-size: 1.5em;
            font-weight: 700;
        }

        /* ========== TRANSACTIONS LIST ========== */
        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--card-bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .transaction-item.expense {
            border-left-color: var(--danger);
        }

        .transaction-item.income {
            border-left-color: var(--success);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-info .title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .transaction-info .category {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1em;
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-date {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .transaction-actions {
            margin-left: 15px;
        }

        /* ========== TASKS & ACTIVITIES ========== */
        .task-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .task-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .task-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.6;
            border-left-color: var(--gray);
        }

        .task-item.priority-high {
            border-left-color: var(--danger);
        }

        .task-item.priority-medium {
            border-left-color: var(--warning);
        }

        .task-item.priority-low {
            border-left-color: var(--success);
        }

        .task-item.deadline-urgent {
            background: linear-gradient(to right, rgba(231, 76, 60, 0.1), transparent);
        }

        .task-item.deadline-soon {
            background: linear-gradient(to right, rgba(243, 156, 18, 0.1), transparent);
        }

        .task-item.deadline-unknown {
            background: linear-gradient(to right, rgba(243, 156, 18, 0.05), transparent);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .checkbox-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-top: 3px;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.05em;
            margin-bottom: 5px;
        }

        .task-subject {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 500;
        }

        .task-deadline {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin: 8px 0;
        }

        .task-deadline i {
            margin-right: 5px;
        }

        .task-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .unknown-badge {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 8px;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-container);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: 1.3em;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--light);
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* ========== ADVICE SECTION ========== */
        .advice-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        body.dark-mode .advice-card {
            background: linear-gradient(135deg, #4A90E2 0%, #5CB3FF 100%);
        }

        .advice-card h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: white;
        }

        .advice-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .advice-item:last-child {
            margin-bottom: 0;
        }

        .advice-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 1.05em;
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .empty-state p {
            font-size: 1.1em;
        }

        /* ========== CHARTS ========== */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        /* ========== RESET BUTTON ========== */
        .danger-zone {
            margin-top: 30px;
            padding: 20px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 10px;
            border: 2px dashed var(--danger);
        }

        .danger-zone h4 {
            color: var(--danger);
            margin-bottom: 10px;
        }

        .danger-zone p {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.4em;
            }

            .tabs {
                justify-content: flex-start;
            }

            .tab {
                font-size: 0.75em;
                padding: 12px 8px;
            }

            .tab i {
                font-size: 1.1em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .transaction-actions {
                margin-left: 0;
                margin-top: 10px;
            }

            .chart-container {
                height: 250px;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* ========== SCROLLBAR STYLING ========== */
        .transaction-list::-webkit-scrollbar,
        .task-list::-webkit-scrollbar {
            width: 8px;
        }

        .transaction-list::-webkit-scrollbar-track,
        .task-list::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .transaction-list::-webkit-scrollbar-thumb,
        .task-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .transaction-list::-webkit-scrollbar-thumb:hover,
        .task-list::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <h1>üè† KosKu</h1>
            <p>Pengelola Keuangan & Tugas Mahasiswa Kos</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')" aria-label="Keuangan Harian">
                <i class="fas fa-calendar-day"></i>
                Harian
            </button>
            <button class="tab" onclick="switchTab('monthly')" aria-label="Keuangan Bulanan">
                <i class="fas fa-calendar-alt"></i>
                Bulanan
            </button>
            <button class="tab" onclick="switchTab('yearly')" aria-label="Keuangan Tahunan">
                <i class="fas fa-chart-line"></i>
                Tahunan
            </button>
            <button class="tab" onclick="switchTab('tasks')" aria-label="Tugas Kuliah">
                <i class="fas fa-tasks"></i>
                Tugas
            </button>
            <button class="tab" onclick="switchTab('activities')" aria-label="Kegiatan Luar">
                <i class="fas fa-clipboard-list"></i>
                Kegiatan
            </button>
            <button class="tab" onclick="switchTab('advice')" aria-label="Saran & Tips">
                <i class="fas fa-lightbulb"></i>
                Saran
            </button>
        </div>

        <!-- Content Sections -->
        <div class="content">
            <!-- KEUANGAN HARIAN -->
            <div id="daily" class="section active">
                <h2>üí∞ Keuangan Harian</h2>
                
                <!-- Stats -->
                <div class="stats-grid" id="dailyStats"></div>

                <!-- Form Input -->
                <div class="card">
                    <h3>Tambah Transaksi</h3>
                    <form id="dailyForm">
                        <div class="form-group">
                            <label for="dailyType">Tipe</label>
                            <select id="dailyType" required>
                                <option value="">Pilih Tipe</option>
                                <option value="expense">Pengeluaran</option>
                                <option value="income">Pemasukan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dailyAmount">Jumlah (Rp)</label>
                            <input type="number" id="dailyAmount" placeholder="50000" min="0" step="1000" required>
                        </div>
                        <div class="form-group">
                            <label for="dailyCategory">Kategori</label>
                            <select id="dailyCategory" required>
                                <option value="">Pilih Kategori</option>
                                <optgroup label="Pengeluaran">
                                    <option value="Makan & Minum">üçî Makan & Minum</option>
                                    <option value="Transportasi">üöå Transportasi</option>
                                    <option value="Hiburan">üéÆ Hiburan</option>
                                    <option value="Kebutuhan">üõí Kebutuhan</option>
                                    <option value="Lainnya">üì¶ Lainnya</option>
                                </optgroup>
                                <optgroup label="Pemasukan">
                                    <option value="Uang Saku">üíµ Uang Saku</option>
                                    <option value="Kerja Sampingan">üíº Kerja Sampingan</option>
                                    <option value="Lainnya">üí∞ Lainnya</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dailyDescription">Deskripsi</label>
                            <input type="text" id="dailyDescription" placeholder="Contoh: Makan siang di kantin" required>
                        </div>
                        <div class="form-group">
                            <label for="dailyDate">Tanggal</label>
                            <input type="date" id="dailyDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Transaksi
                        </button>
                    </form>
                </div>

                <!-- Chart -->
                <div class="card">
                    <h3>Tren Pengeluaran 7 Hari Terakhir</h3>
                    <div class="chart-container">
                        <canvas id="dailyExpenseChart"></canvas>
                    </div>
                </div>

                <!-- Transaction List -->
                <div class="card">
                    <h3>Riwayat Transaksi Hari Ini</h3>
                    <div id="dailyList"></div>
                </div>
            </div>

            <!-- KEUANGAN BULANAN -->
            <div id="monthly" class="section">
                <h2>üìä Keuangan Bulanan</h2>
                
                <!-- Stats -->
                <div class="stats-grid" id="monthlyStats"></div>

                <!-- Charts -->
                <div class="card">
                    <h3>Tren Pengeluaran per Kategori</h3>
                    <div class="chart-container">
                        <canvas id="monthlyExpenseChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>Tren Pemasukan per Kategori</h3>
                    <div class="chart-container">
                        <canvas id="monthlyIncomeChart"></canvas>
                    </div>
                </div>

                <!-- Transaction List -->
                <div class="card">
                    <h3>Riwayat Transaksi Bulan Ini</h3>
                    <div id="monthlyList"></div>
                </div>
            </div>

            <!-- KEUANGAN TAHUNAN -->
            <div id="yearly" class="section">
                <h2>üìà Keuangan Tahunan</h2>
                
                <!-- Stats -->
                <div class="stats-grid" id="yearlyStats"></div>

                <!-- Charts -->
                <div class="card">
                    <h3>Tren Bulanan Tahun Ini</h3>
                    <div class="chart-container">
                        <canvas id="yearlyTrendChart"></canvas>
                    </div>
                </div>

                <!-- Transaction List -->
                <div class="card">
                    <h3>Riwayat Transaksi Tahun Ini</h3>
                    <div id="yearlyList"></div>
                </div>
            </div>

            <!-- TUGAS KULIAH -->
            <div id="tasks" class="section">
                <h2>üìö Tugas Kuliah</h2>
                
                <!-- Form Input -->
                <div class="card">
                    <h3>Tambah Tugas Baru</h3>
                    <form id="taskForm">
                        <div class="form-group">
                            <label for="taskName">Nama Tugas</label>
                            <input type="text" id="taskName" placeholder="Contoh: Laporan Praktikum Fisika" required>
                        </div>
                        <div class="form-group">
                            <label for="taskSubject">Mata Kuliah</label>
                            <input type="text" id="taskSubject" placeholder="Contoh: Fisika Dasar" required>
                        </div>
                        <div class="form-group">
                            <label for="taskDeadline">Deadline</label>
                            <input type="date" id="taskDeadline">
                            <label class="checkbox-label">
                                <input type="checkbox" id="taskUnknownDeadline" onchange="toggleDeadlineField()">
                                <span>üìù Deadline belum ditentukan</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="taskPriority">Prioritas</label>
                            <select id="taskPriority" required>
                                <option value="">Pilih Prioritas</option>
                                <option value="high">üî¥ Tinggi</option>
                                <option value="medium">üü° Sedang</option>
                                <option value="low">üü¢ Rendah</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Tugas
                        </button>
                    </form>
                </div>

                <!-- Task List -->
                <div class="card">
                    <h3>Daftar Tugas</h3>
                    <div id="taskList"></div>
                </div>
            </div>

            <!-- KEGIATAN LUAR KULIAH -->
            <div id="activities" class="section">
                <h2>üéØ Kegiatan Luar Kuliah</h2>
                
                <!-- Form Input -->
                <div class="card">
                    <h3>Tambah Kegiatan Baru</h3>
                    <form id="activityForm">
                        <div class="form-group">
                            <label for="activityName">Nama Kegiatan</label>
                            <input type="text" id="activityName" placeholder="Contoh: Olahraga Futsal" required>
                        </div>
                        <div class="form-group">
                            <label for="activityDateTime">Tanggal & Waktu</label>
                            <input type="datetime-local" id="activityDateTime" required>
                        </div>
                        <div class="form-group">
                            <label for="activityLocation">Lokasi</label>
                            <input type="text" id="activityLocation" placeholder="Contoh: Lapangan Kampus">
                        </div>
                        <div class="form-group">
                            <label for="activityNote">Catatan</label>
                            <textarea id="activityNote" placeholder="Catatan tambahan (opsional)"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Kegiatan
                        </button>
                    </form>
                </div>

                <!-- Activity List -->
                <div class="card">
                    <h3>Daftar Kegiatan</h3>
                    <div id="activityList"></div>
                </div>
            </div>

            <!-- SARAN & TIPS -->
            <div id="advice" class="section">
                <h2>üí° Saran & Tips Pengelolaan</h2>
                <div id="adviceContent"></div>

                <!-- Reset Data -->
                <div class="danger-zone">
                    <h4>‚ö†Ô∏è Zona Berbahaya</h4>
                    <p>Reset semua data akan menghapus seluruh transaksi, tugas, dan kegiatan secara permanen!</p>
                    <button class="btn btn-danger" onclick="resetAllData()">
                        <i class="fas fa-exclamation-triangle"></i> Reset Semua Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Deadline Modal -->
    <div id="updateDeadlineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÖ Update Deadline</h3>
                <button class="modal-close" onclick="closeUpdateDeadlineModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalTaskName">Tugas:</label>
                    <input type="text" id="modalTaskName" readonly style="background: var(--light); cursor: not-allowed;">
                </div>
                <div class="form-group">
                    <label for="modalDeadlineDate">Deadline Baru:</label>
                    <input type="date" id="modalDeadlineDate" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeUpdateDeadlineModal()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn btn-success" onclick="saveDeadlineUpdate()">
                    <i class="fas fa-check"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL VARIABLES ==========
        let dailyTransactions = [];
        let monthlyTransactions = [];
        let yearlyTransactions = [];
        let tasks = [];
        let activities = [];
        let chartInstances = {};
        let currentUpdateTaskId = null;

        // Set current date to November 15, 2025 for testing
        const CURRENT_DATE = new Date('2025-11-15');

        // ========== UTILITY FUNCTIONS ==========
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateStr) {
            if (!dateStr || dateStr === 'unknown') return 'TBD';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
            } catch (e) {
                return dateStr;
            }
        }

        function formatDateTime(dateTimeStr) {
            try {
                const date = new Date(dateTimeStr);
                return date.toLocaleString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateTimeStr;
            }
        }

        function getDaysUntil(dateStr) {
            if (!dateStr || dateStr === 'unknown') return null;
            try {
                const now = new Date(CURRENT_DATE);
                now.setHours(0, 0, 0, 0);
                const deadline = new Date(dateStr);
                deadline.setHours(0, 0, 0, 0);
                const diffTime = deadline - now;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            } catch (e) {
                return null;
            }
        }

        function getUniqueId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function safeLocalStorage(action, key, value = null) {
            try {
                if (action === 'get') {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } else if (action === 'set') {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } else if (action === 'remove') {
                    localStorage.removeItem(key);
                    return true;
                }
            } catch (e) {
                console.error('localStorage error:', e);
                return action === 'get' ? null : false;
            }
        }

        // ========== THEME MANAGEMENT ==========
        function initTheme() {
            const savedTheme = safeLocalStorage('get', 'theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            safeLocalStorage('set', 'theme', isDark ? 'dark' : 'light');
            
            // Update all charts with new theme colors
            updateAllChartsTheme();
        }

        function getChartColors() {
            const isDark = document.body.classList.contains('dark-mode');
            return {
                gridColor: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                textColor: isDark ? '#B8B8B8' : '#666'
            };
        }

        function updateAllChartsTheme() {
            const colors = getChartColors();
            
            Object.keys(chartInstances).forEach(key => {
                const chart = chartInstances[key];
                if (chart && chart.options && chart.options.scales) {
                    Object.keys(chart.options.scales).forEach(scaleKey => {
                        const scale = chart.options.scales[scaleKey];
                        if (scale.grid) scale.grid.color = colors.gridColor;
                        if (scale.ticks) scale.ticks.color = colors.textColor;
                    });
                    chart.update('none'); // Update without animation
                }
            });
        }

        // ========== TAB SWITCHING ==========
        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');
            
            // Update sections
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        // ========== DATA LOADING ==========
        function loadData() {
            dailyTransactions = safeLocalStorage('get', 'dailyTransactions') || [];
            monthlyTransactions = safeLocalStorage('get', 'monthlyTransactions') || [];
            yearlyTransactions = safeLocalStorage('get', 'yearlyTransactions') || [];
            tasks = safeLocalStorage('get', 'tasks') || [];
            activities = safeLocalStorage('get', 'activities') || [];
        }

        // ========== DEADLINE TOGGLE ==========
        function toggleDeadlineField() {
            const checkbox = document.getElementById('taskUnknownDeadline');
            const deadlineInput = document.getElementById('taskDeadline');
            
            if (checkbox.checked) {
                deadlineInput.value = '';
                deadlineInput.disabled = true;
                deadlineInput.style.background = 'var(--light)';
                deadlineInput.style.cursor = 'not-allowed';
            } else {
                deadlineInput.disabled = false;
                deadlineInput.style.background = 'var(--input-bg)';
                deadlineInput.style.cursor = 'text';
                // Set to today's date when unchecked
                const today = CURRENT_DATE.toISOString().split('T')[0];
                deadlineInput.value = today;
            }
        }

        // ========== UPDATE DEADLINE MODAL ==========
        function openUpdateDeadlineModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentUpdateTaskId = taskId;
            document.getElementById('modalTaskName').value = task.name;
            
            // Set minimum date to today
            const today = CURRENT_DATE.toISOString().split('T')[0];
            document.getElementById('modalDeadlineDate').min = today;
            document.getElementById('modalDeadlineDate').value = today;
            
            document.getElementById('updateDeadlineModal').classList.add('active');
        }

        function closeUpdateDeadlineModal() {
            document.getElementById('updateDeadlineModal').classList.remove('active');
            currentUpdateTaskId = null;
            document.getElementById('modalDeadlineDate').value = '';
        }

        function saveDeadlineUpdate() {
            if (!currentUpdateTaskId) return;
            
            const newDeadline = document.getElementById('modalDeadlineDate').value;
            if (!newDeadline) {
                alert('‚ö†Ô∏è Pilih tanggal deadline terlebih dahulu!');
                return;
            }
            
            const task = tasks.find(t => t.id === currentUpdateTaskId);
            if (task) {
                task.deadline = newDeadline;
                safeLocalStorage('set', 'tasks', tasks);
                renderTasks();
                renderAdvice();
                closeUpdateDeadlineModal();
                alert('‚úÖ Deadline berhasil diupdate!');
            }
        }

        // Close modal when clicking outside
        document.getElementById('updateDeadlineModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeUpdateDeadlineModal();
            }
        });

        // ========== DAILY FINANCE ==========
        document.getElementById('dailyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('dailyAmount').value);
            if (amount <= 0) {
                alert('‚ö†Ô∏è Jumlah harus lebih dari 0!');
                return;
            }
            
            const transaction = {
                id: getUniqueId(),
                type: document.getElementById('dailyType').value,
                amount: amount,
                category: document.getElementById('dailyCategory').value,
                description: document.getElementById('dailyDescription').value,
                date: document.getElementById('dailyDate').value
            };
            
            dailyTransactions.push(transaction);
            monthlyTransactions.push(transaction);
            yearlyTransactions.push(transaction);
            
            safeLocalStorage('set', 'dailyTransactions', dailyTransactions);
            safeLocalStorage('set', 'monthlyTransactions', monthlyTransactions);
            safeLocalStorage('set', 'yearlyTransactions', yearlyTransactions);
            
            this.reset();
            const today = CURRENT_DATE.toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            alert('‚úÖ Transaksi berhasil ditambahkan!');
            
            renderDaily();
            renderMonthly();
            renderYearly();
            renderAdvice();
        });

        function deleteTransaction(id, scope) {
            if (confirm('Hapus transaksi ini?')) {
                if (scope === 'daily') {
                    dailyTransactions = dailyTransactions.filter(t => t.id !== id);
                    monthlyTransactions = monthlyTransactions.filter(t => t.id !== id);
                    yearlyTransactions = yearlyTransactions.filter(t => t.id !== id);
                    safeLocalStorage('set', 'dailyTransactions', dailyTransactions);
                } else if (scope === 'monthly') {
                    monthlyTransactions = monthlyTransactions.filter(t => t.id !== id);
                    yearlyTransactions = yearlyTransactions.filter(t => t.id !== id);
                    safeLocalStorage('set', 'monthlyTransactions', monthlyTransactions);
                } else if (scope === 'yearly') {
                    yearlyTransactions = yearlyTransactions.filter(t => t.id !== id);
                    safeLocalStorage('set', 'yearlyTransactions', yearlyTransactions);
                }
                
                safeLocalStorage('set', 'monthlyTransactions', monthlyTransactions);
                safeLocalStorage('set', 'yearlyTransactions', yearlyTransactions);
                
                renderDaily();
                renderMonthly();
                renderYearly();
                renderAdvice();
            }
        }

        function renderDaily() {
            const today = CURRENT_DATE.toISOString().split('T')[0];
            const todayTransactions = dailyTransactions.filter(t => t.date === today);
            
            // Calculate stats
            const totalExpense = todayTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const totalIncome = todayTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense;
            
            // Render stats
            document.getElementById('dailyStats').innerHTML = `
                <div class="stat-card expense">
                    <h4>Pengeluaran Hari Ini</h4>
                    <div class="amount">${formatRupiah(totalExpense)}</div>
                </div>
                <div class="stat-card income">
                    <h4>Pemasukan Hari Ini</h4>
                    <div class="amount">${formatRupiah(totalIncome)}</div>
                </div>
                <div class="stat-card balance">
                    <h4>Saldo Hari Ini</h4>
                    <div class="amount">${formatRupiah(balance)}</div>
                </div>
            `;
            
            // Render chart
            renderDailyExpenseChart();
            
            // Render transaction list
            const container = document.getElementById('dailyList');
            
            if (todayTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>Belum ada transaksi hari ini</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...todayTransactions].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            container.innerHTML = `
                <div class="transaction-list">
                    ${sortedTransactions.map(t => `
                        <div class="transaction-item ${t.type}">
                            <div class="transaction-info">
                                <div class="title">${escapeHtml(t.description)}</div>
                                <div class="category">${escapeHtml(t.category)}</div>
                                <div class="transaction-date">${formatDate(t.date)}</div>
                            </div>
                            <div class="transaction-amount ${t.type}">
                                ${t.type === 'expense' ? '-' : '+'} ${formatRupiah(t.amount)}
                            </div>
                            <div class="transaction-actions">
                                <button class="btn btn-danger" onclick="deleteTransaction('${t.id}', 'daily')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderDailyExpenseChart() {
            const ctx = document.getElementById('dailyExpenseChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (chartInstances.dailyExpense) {
                chartInstances.dailyExpense.destroy();
            }
            
            const colors = getChartColors();
            
            // Get last 7 days of expenses
            const last7Days = [];
            const expenseByDay = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(CURRENT_DATE);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last7Days.push(date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }));
                
                const dayExpenses = dailyTransactions.filter(t => 
                    t.date === dateStr && t.type === 'expense'
                ).reduce((sum, t) => sum + t.amount, 0);
                
                expenseByDay.push(dayExpenses);
            }
            
            const hasData = expenseByDay.some(val => val > 0);
            
            if (!hasData) {
                ctx.parentElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Belum ada data untuk grafik ini. Tambahkan transaksi untuk melihat tren!</p>
                    </div>
                `;
                return;
            }
            
            chartInstances.dailyExpense = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Pengeluaran',
                        data: expenseByDay,
                        borderColor: '#E74C3C',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatRupiah(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatRupiah(value);
                                },
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        }
                    }
                }
            });
        }

        // ========== MONTHLY FINANCE ==========
        function renderMonthly() {
            const now = new Date(CURRENT_DATE);
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthTransactions = monthlyTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });
            
            // Calculate stats
            const totalExpense = monthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const totalIncome = monthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense;
            
            // Render stats
            document.getElementById('monthlyStats').innerHTML = `
                <div class="stat-card expense">
                    <h4>Pengeluaran Bulan Ini</h4>
                    <div class="amount">${formatRupiah(totalExpense)}</div>
                </div>
                <div class="stat-card income">
                    <h4>Pemasukan Bulan Ini</h4>
                    <div class="amount">${formatRupiah(totalIncome)}</div>
                </div>
                <div class="stat-card balance">
                    <h4>Saldo Bulan Ini</h4>
                    <div class="amount">${formatRupiah(balance)}</div>
                </div>
            `;
            
            // Render charts
            renderMonthlyExpenseChart(monthTransactions);
            renderMonthlyIncomeChart(monthTransactions);
            
            // Render transaction list
            const container = document.getElementById('monthlyList');
            
            if (monthTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>Belum ada transaksi bulan ini</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...monthTransactions].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            container.innerHTML = `
                <div class="transaction-list">
                    ${sortedTransactions.map(t => `
                        <div class="transaction-item ${t.type}">
                            <div class="transaction-info">
                                <div class="title">${escapeHtml(t.description)}</div>
                                <div class="category">${escapeHtml(t.category)}</div>
                                <div class="transaction-date">${formatDate(t.date)}</div>
                            </div>
                            <div class="transaction-amount ${t.type}">
                                ${t.type === 'expense' ? '-' : '+'} ${formatRupiah(t.amount)}
                            </div>
                            <div class="transaction-actions">
                                <button class="btn btn-danger" onclick="deleteTransaction('${t.id}', 'monthly')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMonthlyExpenseChart(transactions) {
            const ctx = document.getElementById('monthlyExpenseChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (chartInstances.monthlyExpense) {
                chartInstances.monthlyExpense.destroy();
            }
            
            const colors = getChartColors();
            
            const expenses = transactions.filter(t => t.type === 'expense');
            
            if (expenses.length === 0) {
                ctx.parentElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Belum ada data untuk grafik ini. Tambahkan transaksi untuk melihat tren!</p>
                    </div>
                `;
                return;
            }
            
            const categoryTotals = {};
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            
            const categories = Object.keys(categoryTotals);
            const amounts = Object.values(categoryTotals);
            
            chartInstances.monthlyExpense = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Pengeluaran',
                        data: amounts,
                        borderColor: '#E74C3C',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatRupiah(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatRupiah(value);
                                },
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: colors.textColor,
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        }
                    }
                }
            });
        }

        function renderMonthlyIncomeChart(transactions) {
            const ctx = document.getElementById('monthlyIncomeChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (chartInstances.monthlyIncome) {
                chartInstances.monthlyIncome.destroy();
            }
            
            const colors = getChartColors();
            
            const incomes = transactions.filter(t => t.type === 'income');
            
            if (incomes.length === 0) {
                ctx.parentElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Belum ada data untuk grafik ini. Tambahkan transaksi untuk melihat tren!</p>
                    </div>
                `;
                return;
            }
            
            const categoryTotals = {};
            incomes.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            
            const categories = Object.keys(categoryTotals);
            const amounts = Object.values(categoryTotals);
            
            chartInstances.monthlyIncome = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Pemasukan',
                        data: amounts,
                        borderColor: '#27AE60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return formatRupiah(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatRupiah(value);
                                },
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: colors.textColor,
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        }
                    }
                }
            });
        }

        // ========== YEARLY FINANCE ==========
        function renderYearly() {
            const currentYear = new Date(CURRENT_DATE).getFullYear();
            
            const yearTransactions = yearlyTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getFullYear() === currentYear;
            });
            
            // Calculate stats
            const totalExpense = yearTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            const totalIncome = yearTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense;
            
            // Render stats
            document.getElementById('yearlyStats').innerHTML = `
                <div class="stat-card expense">
                    <h4>Pengeluaran Tahun Ini</h4>
                    <div class="amount">${formatRupiah(totalExpense)}</div>
                </div>
                <div class="stat-card income">
                    <h4>Pemasukan Tahun Ini</h4>
                    <div class="amount">${formatRupiah(totalIncome)}</div>
                </div>
                <div class="stat-card balance">
                    <h4>Saldo Tahun Ini</h4>
                    <div class="amount">${formatRupiah(balance)}</div>
                </div>
            `;
            
            // Render chart
            renderYearlyTrendChart(yearTransactions);
            
            // Render transaction list
            const container = document.getElementById('yearlyList');
            
            if (yearTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>Belum ada transaksi tahun ini</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...yearTransactions].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            container.innerHTML = `
                <div class="transaction-list">
                    ${sortedTransactions.map(t => `
                        <div class="transaction-item ${t.type}">
                            <div class="transaction-info">
                                <div class="title">${escapeHtml(t.description)}</div>
                                <div class="category">${escapeHtml(t.category)}</div>
                                <div class="transaction-date">${formatDate(t.date)}</div>
                            </div>
                            <div class="transaction-amount ${t.type}">
                                ${t.type === 'expense' ? '-' : '+'} ${formatRupiah(t.amount)}
                            </div>
                            <div class="transaction-actions">
                                <button class="btn btn-danger" onclick="deleteTransaction('${t.id}', 'yearly')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderYearlyTrendChart(transactions) {
            const ctx = document.getElementById('yearlyTrendChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (chartInstances.yearlyTrend) {
                chartInstances.yearlyTrend.destroy();
            }
            
            const colors = getChartColors();
            
            if (transactions.length === 0) {
                ctx.parentElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Belum ada data untuk grafik ini. Tambahkan transaksi untuk melihat tren!</p>
                    </div>
                `;
                return;
            }
            
            // Group by month
            const monthlyData = Array(12).fill(null).map(() => ({ income: 0, expense: 0 }));
            
            transactions.forEach(t => {
                const month = new Date(t.date).getMonth();
                if (t.type === 'income') {
                    monthlyData[month].income += t.amount;
                } else {
                    monthlyData[month].expense += t.amount;
                }
            });
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agt', 'Sep', 'Okt', 'Nov', 'Des'];
            
            chartInstances.yearlyTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: monthlyData.map(m => m.income),
                            borderColor: '#27AE60',
                            backgroundColor: 'rgba(39, 174, 96, 0.2)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'Pengeluaran',
                            data: monthlyData.map(m => m.expense),
                            borderColor: '#E74C3C',
                            backgroundColor: 'rgba(231, 76, 60, 0.2)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: colors.textColor,
                                padding: 15,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatRupiah(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatRupiah(value);
                                },
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        },
                        x: {
                            ticks: {
                                color: colors.textColor
                            },
                            grid: {
                                color: colors.gridColor
                            }
                        }
                    }
                }
            });
        }

        // ========== TASK MANAGEMENT ==========
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const unknownCheckbox = document.getElementById('taskUnknownDeadline');
            let deadlineValue;
            
            if (unknownCheckbox.checked) {
                deadlineValue = 'unknown';
            } else {
                deadlineValue = document.getElementById('taskDeadline').value;
                if (!deadlineValue) {
                    alert('‚ö†Ô∏è Pilih tanggal deadline atau centang "Deadline belum ditentukan"!');
                    return;
                }
            }
            
            const task = {
                id: getUniqueId(),
                name: document.getElementById('taskName').value,
                subject: document.getElementById('taskSubject').value,
                deadline: deadlineValue,
                priority: document.getElementById('taskPriority').value,
                completed: false
            };
            
            tasks.push(task);
            safeLocalStorage('set', 'tasks', tasks);
            
            this.reset();
            document.getElementById('taskDeadline').disabled = false;
            document.getElementById('taskDeadline').style.background = 'var(--input-bg)';
            alert('‚úÖ Tugas berhasil ditambahkan!');
            
            renderTasks();
            renderAdvice();
        });

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                safeLocalStorage('set', 'tasks', tasks);
                renderTasks();
                renderAdvice();
            }
        }

        function deleteTask(id) {
            if (confirm('Hapus tugas ini?')) {
                tasks = tasks.filter(t => t.id !== id);
                safeLocalStorage('set', 'tasks', tasks);
                renderTasks();
                renderAdvice();
            }
        }

        function renderTasks() {
            const container = document.getElementById('taskList');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <p>Belum ada tugas kuliah</p>
                    </div>
                `;
                return;
            }
            
            // Sort: completed last, then unknown deadline last, then by deadline
            const sortedTasks = [...tasks].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                
                // Both not completed
                if (!a.completed && !b.completed) {
                    // Put unknown deadlines at the end
                    if (a.deadline === 'unknown' && b.deadline !== 'unknown') return 1;
                    if (a.deadline !== 'unknown' && b.deadline === 'unknown') return -1;
                    if (a.deadline === 'unknown' && b.deadline === 'unknown') return 0;
                    
                    // Sort by deadline date
                    return new Date(a.deadline) - new Date(b.deadline);
                }
                
                return 0;
            });
            
            container.innerHTML = `
                <div class="task-list">
                    ${sortedTasks.map(t => {
                        let urgencyClass = '';
                        let urgencyText = '';
                        
                        if (!t.completed) {
                            if (t.deadline === 'unknown') {
                                urgencyClass = 'deadline-unknown';
                                urgencyText = '<span class="unknown-badge">TBD</span> <span style="color: #F39C12; font-weight: 600; margin-left: 8px;">üìù Segera update deadline!</span>';
                            } else {
                                const daysUntil = getDaysUntil(t.deadline);
                                
                                if (daysUntil < 0) {
                                    urgencyClass = 'deadline-urgent';
                                    urgencyText = `<span style="color: #E74C3C; font-weight: 600;">‚ö†Ô∏è Terlambat ${Math.abs(daysUntil)} hari</span>`;
                                } else if (daysUntil === 0) {
                                    urgencyClass = 'deadline-urgent';
                                    urgencyText = '<span style="color: #E74C3C; font-weight: 600;">‚ö†Ô∏è Deadline hari ini!</span>';
                                } else if (daysUntil === 1) {
                                    urgencyClass = 'deadline-urgent';
                                    urgencyText = '<span style="color: #E74C3C; font-weight: 600;">‚ö†Ô∏è Deadline besok!</span>';
                                } else if (daysUntil <= 7) {
                                    urgencyClass = 'deadline-soon';
                                    urgencyText = `<span style="color: #F39C12; font-weight: 600;">‚è∞ ${daysUntil} hari lagi</span>`;
                                } else {
                                    urgencyText = `<span style="color: #27AE60;">${daysUntil} hari lagi</span>`;
                                }
                            }
                        }
                        
                        const deadlineDisplay = t.deadline === 'unknown' 
                            ? '' 
                            : formatDate(t.deadline);
                        
                        return `
                            <div class="task-item priority-${t.priority} ${urgencyClass} ${t.completed ? 'completed' : ''}">
                                <div class="task-header">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTask('${t.id}')" aria-label="Toggle task completion">
                                        <div>
                                            <div class="task-title">${escapeHtml(t.name)}</div>
                                            <span class="task-subject">${escapeHtml(t.subject)}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="task-deadline">
                                    <i class="fas fa-calendar-alt"></i> ${deadlineDisplay} ${urgencyText}
                                </div>
                                <div class="task-actions">
                                    ${t.deadline === 'unknown' && !t.completed ? `
                                        <button class="btn btn-warning" onclick="openUpdateDeadlineModal('${t.id}')">
                                            <i class="fas fa-edit"></i> Update Deadline
                                        </button>
                                    ` : ''}
                                    <button class="btn btn-danger" onclick="deleteTask('${t.id}')">
                                        <i class="fas fa-trash"></i> Hapus
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // ========== ACTIVITY MANAGEMENT ==========
        document.getElementById('activityForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const activity = {
                id: getUniqueId(),
                name: document.getElementById('activityName').value,
                dateTime: document.getElementById('activityDateTime').value,
                location: document.getElementById('activityLocation').value,
                note: document.getElementById('activityNote').value,
                completed: false
            };
            
            activities.push(activity);
            safeLocalStorage('set', 'activities', activities);
            
            this.reset();
            alert('‚úÖ Kegiatan berhasil ditambahkan!');
            
            renderActivities();
            renderAdvice();
        });

        function toggleActivity(id) {
            const activity = activities.find(a => a.id === id);
            if (activity) {
                activity.completed = !activity.completed;
                safeLocalStorage('set', 'activities', activities);
                renderActivities();
                renderAdvice();
            }
        }

        function deleteActivity(id) {
            if (confirm('Hapus kegiatan ini?')) {
                activities = activities.filter(a => a.id !== id);
                safeLocalStorage('set', 'activities', activities);
                renderActivities();
                renderAdvice();
            }
        }

        function renderActivities() {
            const container = document.getElementById('activityList');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Belum ada kegiatan luar kuliah</p>
                    </div>
                `;
                return;
            }
            
            // Sort by datetime (nearest first), then by completed status
            const sortedActivities = [...activities].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return new Date(a.dateTime) - new Date(b.dateTime);
            });
            
            container.innerHTML = `
                <div class="task-list">
                    ${sortedActivities.map(a => `
                        <div class="task-item activity-item ${a.completed ? 'completed' : ''}">
                            <div class="task-header">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" ${a.completed ? 'checked' : ''} onchange="toggleActivity('${a.id}')" aria-label="Toggle activity completion">
                                    <div>
                                        <div class="task-title">${escapeHtml(a.name)}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="task-deadline">
                                <i class="fas fa-clock"></i> ${formatDateTime(a.dateTime)}
                            </div>
                            ${a.location ? `<div style="margin: 5px 0; color: var(--text-secondary);"><i class="fas fa-map-marker-alt"></i> ${escapeHtml(a.location)}</div>` : ''}
                            ${a.note ? `<div style="margin: 8px 0; color: var(--text-secondary); font-size: 0.9em;">${escapeHtml(a.note)}</div>` : ''}
                            <div class="task-actions">
                                <button class="btn btn-danger" onclick="deleteActivity('${a.id}')">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ========== ADVICE & TIPS ==========
        let adviceTimeout;
        function renderAdvice() {
            clearTimeout(adviceTimeout);
            adviceTimeout = setTimeout(() => {
                const container = document.getElementById('adviceContent');
                
                // Calculate all data
                const now = new Date(CURRENT_DATE);
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                const monthTransactions = monthlyTransactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
                });
                
                const totalExpense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                const totalIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                const balance = totalIncome - totalExpense;
                
                const urgentTasks = tasks.filter(t => {
                    if (t.completed || t.deadline === 'unknown') return false;
                    const days = getDaysUntil(t.deadline);
                    return days !== null && days <= 3;
                });
                
                const unknownTasks = tasks.filter(t => !t.completed && t.deadline === 'unknown');
                
                const upcomingActivities = activities.filter(a => {
                    if (a.completed) return false;
                    const actDate = new Date(a.dateTime);
                    const nowDate = new Date(CURRENT_DATE);
                    const diffHours = (actDate - nowDate) / (1000 * 60 * 60);
                    return diffHours > 0 && diffHours <= 48;
                });
                
                let adviceHTML = '<div class="advice-card"><h3>üí° Saran untuk Kamu</h3>';
                
                // Financial advice
                if (balance < 0) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>‚ö†Ô∏è Pengeluaran Melebihi Pemasukan!</strong>
                            Saldo bulan ini minus ${formatRupiah(Math.abs(balance))}. 
                            Coba kurangi pengeluaran tidak penting seperti hiburan atau jajan.
                        </div>
                    `;
                } else if (balance > 0 && totalExpense > totalIncome * 0.8) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>‚ö° Pengeluaran Mendekati Pemasukan</strong>
                            ${Math.round((totalExpense/totalIncome) * 100)}% dari pemasukan terpakai. 
                            Sisihkan minimal 20% untuk tabungan darurat!
                        </div>
                    `;
                } else if (balance > totalIncome * 0.3) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>‚úÖ Pengelolaan Keuangan Bagus!</strong>
                            Kamu berhasil menyisihkan ${formatRupiah(balance)} bulan ini. 
                            Pertahankan kebiasaan baik ini!
                        </div>
                    `;
                }
                
                // Task advice
                if (urgentTasks.length > 0) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üìö ${urgentTasks.length} Tugas Mendesak!</strong>
                            Ada tugas dengan deadline ‚â§3 hari: ${urgentTasks.map(t => escapeHtml(t.name)).join(', ')}. 
                            Prioritaskan segera!
                        </div>
                    `;
                }
                
                // Unknown deadline advice - enhanced
                if (unknownTasks.length >= 2) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üìù Update Deadline untuk ${unknownTasks.length} Tugas TBD</strong>
                            Kamu memiliki ${unknownTasks.length} tugas tanpa deadline: ${unknownTasks.map(t => escapeHtml(t.name)).join(', ')}. 
                            Segera tanyakan ke dosen dan update deadline agar tidak ketinggalan! 
                            Gunakan tombol "Update Deadline" di setiap tugas.
                        </div>
                    `;
                } else if (unknownTasks.length === 1) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üìù Update Deadline Tugas</strong>
                            Tugas "${escapeHtml(unknownTasks[0].name)}" belum memiliki deadline. 
                            Segera tanyakan ke dosen agar bisa direncanakan dengan baik!
                        </div>
                    `;
                }
                
                // Activity advice
                if (upcomingActivities.length > 0) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üéØ Kegiatan dalam 48 Jam</strong>
                            Jangan lupa: ${upcomingActivities.map(a => escapeHtml(a.name) + ' (' + formatDateTime(a.dateTime) + ')').join(', ')}
                        </div>
                    `;
                }
                
                // General tips
                if (totalIncome > 0 && totalExpense === 0) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üí° Tips Pengelolaan Keuangan</strong>
                            Catat setiap pengeluaran sekecil apapun. Transparansi adalah kunci budgeting yang sukses!
                        </div>
                    `;
                }
                
                if (tasks.length === 0 && activities.length === 0) {
                    adviceHTML += `
                        <div class="advice-item">
                            <strong>üìÖ Mulai Catat Kegiatan</strong>
                            Manfaatkan fitur tugas dan kegiatan untuk mengelola waktu dengan lebih baik. 
                            Mahasiswa sukses = mahasiswa yang terorganisir!
                        </div>
                    `;
                }
                
                adviceHTML += '</div>';
                container.innerHTML = adviceHTML;
            }, 300);
        }

        // ========== RESET ALL DATA ==========
        function resetAllData() {
            if (confirm('‚ö†Ô∏è PERINGATAN!\n\nIni akan menghapus SEMUA data:\n- Transaksi keuangan\n- Tugas kuliah\n- Kegiatan luar kuliah\n\nApakah kamu yakin?')) {
                if (confirm('Konfirmasi terakhir: Data yang dihapus TIDAK BISA dikembalikan!')) {
                    try {
                        safeLocalStorage('remove', 'dailyTransactions');
                        safeLocalStorage('remove', 'monthlyTransactions');
                        safeLocalStorage('remove', 'yearlyTransactions');
                        safeLocalStorage('remove', 'tasks');
                        safeLocalStorage('remove', 'activities');
                        
                        dailyTransactions = [];
                        monthlyTransactions = [];
                        yearlyTransactions = [];
                        tasks = [];
                        activities = [];
                        
                        renderDaily();
                        renderMonthly();
                        renderYearly();
                        renderTasks();
                        renderActivities();
                        renderAdvice();
                        
                        alert('‚úÖ Semua data berhasil dihapus!');
                    } catch (e) {
                        alert('‚ùå Terjadi kesalahan saat menghapus data!');
                    }
                }
            }
        }

        // ========== INITIALIZE ON LOAD ==========
        window.addEventListener('DOMContentLoaded', function() {
            initTheme();
            loadData();
            
            // Set default date to current date (November 15, 2025)
            const today = CURRENT_DATE.toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            
            renderDaily();
            renderMonthly();
            renderYearly();
            renderTasks();
            renderActivities();
            renderAdvice();
        });
    </script>
</body>
</html>